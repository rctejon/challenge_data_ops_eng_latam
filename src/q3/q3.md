# Q3: Top 10 usuarios más influyentes

## Objetivo
Obtener los top 10 usuarios más influyentes en función del número de menciones (@) que reciben en los tweets. Retornar el username y su conteo de menciones.

## Enfoque

### Optimización por tiempo (q3_time.py)

**Estrategia**: Carga completa en memoria usando Polars con procesamiento vectorizado.

**Características**:
- Carga completa del dataset en memoria (scan_ndjson + collect)
- Extracción de menciones desde el campo estructurado `mentionedUsers`
- Operaciones de explode + struct.field para extracción eficiente del username
- Group_by para conteo eficiente de menciones por usuario
- Garbage collection estratégico para liberar memoria intermedia
- Trade-off: velocidad máxima a costa de mayor uso de RAM

**Complejidad**:
- Tiempo: O(n) para procesamiento + O(k log k) para sort (k = usuarios únicos)
- Espacio: O(n) por DataFrame en memoria + O(m) por menciones (m = total menciones)

#### Ejecución

**Prerequisitos**:
Asegurarse que el dataset existe en `data/raw/farmers-protest-tweets-2021-2-4.json`. Si no existe, descargar primero:
```bash
python src/dataset/download_dataset.py
```

**Comando de ejecución**:
```bash
python src/q3/q3_time_impl.py
```

**Salida esperada**:
- Muestra los top 10 usuarios más influyentes con su conteo de menciones
- Ejecuta profiling de tiempo con cProfile
- Ejecuta profiling de memoria con memray (si está instalado)

**Archivos generados**:
- `q3_time_polars.prof` - Profiling de tiempo (cProfile)
- `q3_time_polars_mem.bin` - Profiling de memoria (memray)

#### Análisis de profiling

**Analizar profiling de tiempo**:
```bash
python -m pstats q3_time_polars.prof
```

Comandos útiles dentro de pstats:
```
stats 10        # Top 10 funciones por tiempo total
sort cumulative # Ordenar por tiempo acumulativo
sort time       # Ordenar por tiempo propio
```

**Analizar profiling de memoria**:
```bash
# Ver estadísticas generales
memray stats q3_time_polars_mem.bin
```

**Nota**: Si memray no está instalado, se puede instalar con:
```bash
pip install memray
```

### Optimización por memoria (q3_memory.py)

**Estrategia**: Procesamiento con lazy evaluation y materialización mínima.

**Características**:
- Lazy evaluation completa sin collect() intermedio
- Solo materializa el resultado final (top 10)
- Streaming aggregations de Polars
- Trade-off: menor consumo de memoria a costa de mayor tiempo de ejecución (si aplica)

**Complejidad**:
- Tiempo: O(n) para procesamiento streaming
- Espacio: O(1) - solo materializa el resultado final pequeño (top 10 usuarios)

#### Ejecución

**Prerequisitos**:
Asegurarse que el dataset existe en `data/raw/farmers-protest-tweets-2021-2-4.json`. Si no existe, descargar primero:
```bash
python src/dataset/download_dataset.py
```

**Comando de ejecución**:
```bash
python src/q3/q3_memory_impl.py
```

**Salida esperada**:
- Muestra los top 10 usuarios más influyentes con su conteo de menciones
- Ejecuta profiling de tiempo con cProfile
- Ejecuta profiling de memoria con memray (si está instalado)

**Archivos generados**:
- `q3_memory_polars.prof` - Profiling de tiempo (cProfile)
- `q3_memory_polars_mem.bin` - Profiling de memoria (memray)

#### Análisis de profiling

**Analizar profiling de tiempo**:
```bash
python -m pstats q3_memory_polars.prof
```

Comandos útiles dentro de pstats:
```
stats 10        # Top 10 funciones por tiempo total
sort cumulative # Ordenar por tiempo acumulativo
sort time       # Ordenar por tiempo propio
```

**Analizar profiling de memoria**:
```bash
# Ver estadísticas generales
memray stats q3_memory_polars_mem.bin
```

**Nota**: Si memray no está instalado, se puede instalar con:
```bash
pip install memray
```

---

## Resumen de Resultados y Conclusiones (TIME vs MEMORY) – Q3

